@app.route("/register", methods=["GET", "POST"])
def register():
    """Página de cadastro de novos usuários"""
    if request.method == "POST":
        username = request.form.get("username")
        password = request.form.get("password")

        if not username or not password:
            flash("Preencha todos os campos.")
            return redirect(url_for("register"))

        conn = get_db_conn()
        cursor = conn.cursor()

        try:
            cursor.execute(
                "INSERT INTO users (username, password, premium, is_admin) VALUES (?, ?, 0, 0)",
                (username, password)
            )
            conn.commit()
            flash("✅ Usuário registrado com sucesso! Faça login para continuar.")
            return redirect(url_for("index"))
        except sqlite3.IntegrityError:
            flash("⚠️ Nome de usuário já está em uso.")
        finally:
            conn.close()

    return render_template("register.html")
